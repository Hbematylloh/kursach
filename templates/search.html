{% extends "base.html" %}

{% block content %}
<h1 class="mb-4"><i class="bi bi-search"></i> –ü–æ–∏—Å–∫ —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π</h1>

<div class="row">
    <div class="col-md-4">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</h5>
                <form id="searchForm">
                    <div class="mb-3">
                        <label for="date" class="form-label">–î–∞—Ç–∞</label>
                        <input type="date" class="form-control" id="date" 
                               value="{{ now().strftime('%Y-%m-%d') }}" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="start_time" class="form-label">–ù–∞—á–∞–ª–æ</label>
                                <input type="time" class="form-control" id="start_time" 
                                       value="09:00" required>
                            </div>
                        </div>
                        <div class="col-6">
                            <div class="mb-3">
                                <label for="end_time" class="form-label">–ö–æ–Ω–µ—Ü</label>
                                <input type="time" class="form-control" id="end_time" 
                                       value="10:30" required>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="min_capacity" class="form-label">–ú–∏–Ω. –≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</label>
                        <input type="number" class="form-control" id="min_capacity" min="0" value="0">
                    </div>
                    
                    <div class="mb-3">
                        <label for="building" class="form-label">–ö–æ—Ä–ø—É—Å</label>
                        <select class="form-select" id="building">
                            <option value="">–õ—é–±–æ–π</option>
                            <option value="A">–ö–æ—Ä–ø—É—Å –ê</option>
                            <option value="B">–ö–æ—Ä–ø—É—Å B</option>
                        </select>
                    </div>
                    
                    <div class="mb-3">
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="has_projector">
                            <label class="form-check-label" for="has_projector">
                                –ù–∞–ª–∏—á–∏–µ –ø—Ä–æ–µ–∫—Ç–æ—Ä–∞
                            </label>
                        </div>
                        
                        <div class="form-check">
                            <input class="form-check-input" type="checkbox" id="has_computers">
                            <label class="form-check-label" for="has_computers">
                                –ù–∞–ª–∏—á–∏–µ –∫–æ–º–ø—å—é—Ç–µ—Ä–æ–≤
                            </label>
                        </div>
                    </div>
                    
                    <button type="submit" class="btn btn-primary w-100">
                        <i class="bi bi-search"></i> –ù–∞–π—Ç–∏
                    </button>
                </form>
            </div>
        </div>
    </div>
    
    <div class="col-md-8">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">–†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞</h5>
                <div id="results">
                    <p class="text-muted text-center">–ó–∞–¥–∞–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–∏—Å–∫–∞</p>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.getElementById('searchForm').addEventListener('submit', function(e) {
    e.preventDefault();
    
    const searchParams = {
        date: document.getElementById('date').value,
        start_time: document.getElementById('start_time').value,
        end_time: document.getElementById('end_time').value,
        min_capacity: document.getElementById('min_capacity').value,
        building: document.getElementById('building').value,
        has_projector: document.getElementById('has_projector').checked,
        has_computers: document.getElementById('has_computers').checked
    };
    
    fetch('/api/search-free-classrooms', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(searchParams)
    })
    .then(response => response.json())
    .then(data => {
        const resultsDiv = document.getElementById('results');
        
        if (data.length === 0) {
            resultsDiv.innerHTML = '<p class="text-muted text-center">–ù–µ—Ç —Å–≤–æ–±–æ–¥–Ω—ã—Ö –∞—É–¥–∏—Ç–æ—Ä–∏–π</p>';
            return;
        }
        
        let html = '<div class="table-responsive"><table class="table table-striped">';
        html += '<thead><tr><th>–ê—É–¥–∏—Ç–æ—Ä–∏—è</th><th>–ö–æ—Ä–ø—É—Å</th><th>–≠—Ç–∞–∂</th><th>–í–º–µ—Å—Ç–∏–º–æ—Å—Ç—å</th><th>–û–±–æ—Ä—É–¥–æ–≤–∞–Ω–∏–µ</th></tr></thead><tbody>';
        
        data.forEach(c => {
            html += `<tr>
                <td><strong>${c.number}</strong></td>
                <td>${c.building}</td>
                <td>${c.floor}</td>
                <td>${c.capacity} —á–µ–ª.</td>
                <td>`;
            
            if (c.has_projector) html += 'üìΩÔ∏è ';
            if (c.has_computers) html += `üíª${c.computers_count} `;
            if (c.has_air_conditioner) html += '‚ùÑÔ∏è ';
            
            html += `</td></tr>`;
        });
        
        html += '</tbody></table></div>';
        resultsDiv.innerHTML = html;
    });
});
</script>
{% endblock %}